# ==================== –°–ò–°–¢–ï–ú–ê –î–†–£–ó–ï–ô ====================
FRIENDS_DB="$DATA_DIR/friends.db"
REQUESTS_DB="$DATA_DIR/friend_requests.db"

init_friends_db() {
    if [ ! -f "$FRIENDS_DB" ]; then
        echo "user_id|friend_id|friend_name|status|since|last_interaction" > "$FRIENDS_DB"
    fi
    
    if [ ! -f "$REQUESTS_DB" ]; then
        echo "request_id|from_user|to_user|status|timestamp|message" > "$REQUESTS_DB"
    fi
}

friends_menu() {
    while true; do
        clear
        echo -e "${CYAN}"
        echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
        echo "‚ïë               –°–ò–°–¢–ï–ú–ê –î–†–£–ó–ï–ô                    ‚ïë"
        echo "‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£"
        echo "‚ïë  –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: $CURRENT_USER"
        echo "‚ïë  ID: $USER_ID"
        echo "‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£"
        echo "‚ïë                                                  ‚ïë"
        echo "‚ïë  1. üë• –ú–æ–∏ –¥—Ä—É–∑—å—è                               ‚ïë"
        echo "‚ïë  2. ‚ûï –ù–∞–π—Ç–∏ –¥—Ä—É–≥–∞ –ø–æ ID                         ‚ïë"
        echo "‚ïë  3. üì® –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –≤ –¥—Ä—É–∑—å—è                ‚ïë"
        echo "‚ïë  4. üì¨ –í—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã                         ‚ïë"
        echo "‚ïë  5. üì§ –ò—Å—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã                        ‚ïë"
        echo "‚ïë  6. üîç –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π                      ‚ïë"
        echo "‚ïë  7. üí¨ –ß–∞—Ç —Å –¥—Ä—É–≥–æ–º                             ‚ïë"
        echo "‚ïë  8. üéÅ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª –¥—Ä—É–≥—É                     ‚ïë"
        echo "‚ïë  9. üõ°Ô∏è  –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π                ‚ïë"
        echo "‚ïë 10. ‚öôÔ∏è  –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥—Ä—É–∑–µ–π                         ‚ïë"
        echo "‚ïë  0. ‚Ü©Ô∏è  –ù–∞–∑–∞–¥                                    ‚ïë"
        echo "‚ïë                                                  ‚ïë"
        echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
        echo -e "${NC}"
        
        read -p "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ: " choice
        
        case $choice in
            1) show_my_friends ;;
            2) find_friend_by_id ;;
            3) send_friend_request ;;
            4) incoming_requests ;;
            5) outgoing_requests ;;
            6) search_users ;;
            7) chat_with_friend ;;
            8) send_file_to_friend ;;
            9) block_user_menu ;;
            10) friends_settings ;;
            0) return ;;
            *) echo -e "${RED}[!] –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä${NC}"; sleep 1 ;;
        esac
    done
}

find_friend_by_id() {
    clear
    echo -e "${CYAN}"
    echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
    echo "‚ïë           –ü–û–ò–°–ö –î–†–£–ì–ê –ü–û ID                      ‚ïë"
    echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
    echo -e "${NC}"
    
    read -p "–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è: " friend_id
    
    if [ -z "$friend_id" ]; then
        echo -e "${RED}[!] ID –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º${NC}"
        read -p "–ù–∞–∂–º–∏—Ç–µ Enter..."
        return
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∏—â–µ–º –ª–∏ –º—ã —Å–∞–º–∏ —Å–µ–±—è
    if [ "$friend_id" = "$USER_ID" ]; then
        echo -e "${YELLOW}[!] –≠—Ç–æ –≤–∞—à —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π ID${NC}"
        read -p "–ù–∞–∂–º–∏—Ç–µ Enter..."
        return
    fi
    
    # –ò—â–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –±–∞–∑–µ
    friend_info=$(grep "|$friend_id|" "$USERS_DB" | head -1)
    
    if [ -z "$friend_info" ]; then
        echo -e "${RED}[!] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å ID $friend_id –Ω–µ –Ω–∞–π–¥–µ–Ω${NC}"
        echo -e "${YELLOW}[i] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å ID${NC}"
    else
        friend_name=$(echo "$friend_info" | cut -d'|' -f1)
        friend_status=$(echo "$friend_info" | cut -d'|' -f7)
        friend_since=$(echo "$friend_info" | cut -d'|' -f5)
        
        echo -e "\n${GREEN}[‚úì] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–π–¥–µ–Ω!${NC}"
        echo -e "${YELLOW}–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:${NC}"
        echo -e "  –ò–º—è: $friend_name"
        echo -e "  ID: $friend_id"
        echo -e "  –°—Ç–∞—Ç—É—Å: $friend_status"
        echo -e "  –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: $(date -d "@$friend_since" '+%d.%m.%Y')"
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É–∂–µ –¥—Ä—É–∑—å—è –∏–ª–∏ –µ—Å—Ç—å –∑–∞–ø—Ä–æ—Å
        check_friendship_status "$friend_id"
        
        echo -e "\n${YELLOW}–î–µ–π—Å—Ç–≤–∏—è:${NC}"
        echo "1. –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –≤ –¥—Ä—É–∑—å—è"
        echo "2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ"
        echo "3. –ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –≤ –∫–∞–Ω–∞–ª"
        echo "4. –ù–∞–∑–∞–¥"
        
        read -p "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ: " action
        
        case $action in
            1) send_friend_request_to_id "$friend_id" "$friend_name" ;;
            2) send_message_to_friend "$friend_id" "$friend_name" ;;
            3) invite_to_channel "$friend_id" "$friend_name" ;;
        esac
    fi
    
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter..."
}

check_friendship_status() {
    local friend_id="$1"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É–∂–µ –¥—Ä—É–∑—å—è
    if grep -q "^$USER_ID|$friend_id|" "$FRIENDS_DB" || grep -q "^$friend_id|$USER_ID|" "$FRIENDS_DB"; then
        echo -e "${GREEN}  –°—Ç–∞—Ç—É—Å: –£–∂–µ –¥—Ä—É–∑—å—è ‚úì${NC}"
        return 0
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å
    if grep -q "^[^|]*|$USER_ID|$friend_id|pending|" "$REQUESTS_DB"; then
        echo -e "${YELLOW}  –°—Ç–∞—Ç—É—Å: –ï—Å—Ç—å –≤—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å ‚úâÔ∏è${NC}"
        return 1
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å
    if grep -q "^[^|]*|$USER_ID|$friend_id|pending|" "$REQUESTS_DB"; then
        echo -e "${BLUE}  –°—Ç–∞—Ç—É—Å: –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω üì§${NC}"
        return 2
    fi
    
    echo -e "${WHITE}  –°—Ç–∞—Ç—É—Å: –ù–µ –≤ –¥—Ä—É–∑—å—è—Ö${NC}"
    return 3
}

send_friend_request_to_id() {
    local friend_id="$1"
    local friend_name="$2"
    
    echo -e "\n${YELLOW}[i] –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ –¥—Ä—É–∑—å—è...${NC}"
    
    read -p "–î–æ–±–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∫ –∑–∞–ø—Ä–æ—Å—É (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ): " message
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º ID –∑–∞–ø—Ä–æ—Å–∞
    request_id="REQ_$(date +%s)_$RANDOM"
    
    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
    echo "$request_id|$USER_ID|$friend_id|pending|$(date +%s)|$message" >> "$REQUESTS_DB"
    
    echo -e "${GREEN}[‚úì] –ó–∞–ø—Ä–æ—Å –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é $friend_name!${NC}"
    echo -e "${YELLOW}[i] –û–∂–∏–¥–∞–π—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è${NC}"
    
    log_system "FRIEND_REQUEST" "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω –∑–∞–ø—Ä–æ—Å $CURRENT_USER ‚Üí $friend_name" "INFO"
    
    # –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—É—á–∞—Ç–µ–ª—è
    create_notification "$friend_id" "friend_request" \
        "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å $CURRENT_USER –æ—Ç–ø—Ä–∞–≤–∏–ª –≤–∞–º –∑–∞–ø—Ä–æ—Å –≤ –¥—Ä—É–∑—å—è"
}

create_notification() {
    local user_id="$1"
    local type="$2"
    local message="$3"
    
    NOTIF_DIR="$DATA_DIR/notifications"
    mkdir -p "$NOTIF_DIR"
    
    local notif_file="$NOTIF_DIR/${user_id}_notifs.txt"
    local notif_id="NOTIF_$(date +%s)_$RANDOM"
    
    echo "$notif_id|$type|$message|$(date +%s)|unread" >> "$notif_file"
}

show_my_friends() {
    clear
    echo -e "${CYAN}"
    echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
    echo "‚ïë               –ú–û–ò –î–†–£–ó–¨–Ø                         ‚ïë"
    echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
    echo -e "${NC}"
    
    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π
    friends_list=$(grep "^$USER_ID|" "$FRIENDS_DB" | grep "|accepted|")
    
    if [ -z "$friends_list" ]; then
        echo -e "${YELLOW}[i] –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π${NC}"
        echo -e "${WHITE}[i] –ù–∞–π–¥–∏—Ç–µ –¥—Ä—É–∑–µ–π –ø–æ ID –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∏–º –∑–∞–ø—Ä–æ—Å${NC}"
    else
        friend_count=$(echo "$friends_list" | wc -l)
        echo -e "${GREEN}[‚úì] –£ –≤–∞—Å $friend_count –¥—Ä—É–∑–µ–π:${NC}\n"
        
        IFS=$'\n'
        for friend in $friends_list; do
            friend_id=$(echo "$friend" | cut -d'|' -f2)
            friend_name=$(echo "$friend" | cut -d'|' -f3)
            since=$(echo "$friend" | cut -d'|' -f5)
            last_interaction=$(echo "$friend" | cut -d'|' -f6)
            
            echo -e "${BLUE}‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨‚ñ¨${NC}"
            echo -e "${YELLOW}üë§ $friend_name${NC}"
            echo -e "  ID: $friend_id"
            echo -e "  –í –¥—Ä—É–∑—å—è—Ö —Å: $(date -d "@$since" '+%d.%m.%Y')"
            
            if [ "$last_interaction" != "0" ]; then
                echo -e "  –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: $(date -d "@$last_interaction" '+%H:%M %d.%m')"
            fi
            
            # –°—Ç–∞—Ç—É—Å –æ–Ω–ª–∞–π–Ω/–æ—Ñ—Ñ–ª–∞–π–Ω
            check_online_status "$friend_id"
        done
        unset IFS
        
        echo -e "\n${YELLOW}–î–µ–π—Å—Ç–≤–∏—è:${NC}"
        echo "1. –ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ"
        echo "2. –°–æ–∑–¥–∞—Ç—å –æ–±—â–∏–π –∫–∞–Ω–∞–ª"
        echo "3. –£–¥–∞–ª–∏—Ç—å –∏–∑ –¥—Ä—É–∑–µ–π"
        echo "4. –ù–∞–∑–∞–¥"
        
        read -p "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ: " action
        
        case $action in
            1) 
                read -p "–í–≤–µ–¥–∏—Ç–µ ID –¥—Ä—É–≥–∞: " selected_id
                start_chat_with_friend "$selected_id"
                ;;
            2) 
                read -p "–í–≤–µ–¥–∏—Ç–µ ID –¥—Ä—É–≥–∞: " selected_id
                create_shared_channel "$selected_id"
                ;;
            3) 
                read -p "–í–≤–µ–¥–∏—Ç–µ ID –¥—Ä—É–≥–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è: " selected_id
                remove_friend "$selected_id"
                ;;
        esac
    fi
    
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter..."
}

check_online_status() {
    local friend_id="$1"
    local user_file="$DATA_DIR/sessions/$friend_id.status"
    
    if [ -f "$user_file" ]; then
        local last_seen=$(cat "$user_file")
        local current_time=$(date +%s)
        local diff=$((current_time - last_seen))
        
        if [ $diff -lt 300 ]; then  # 5 –º–∏–Ω—É—Ç
            echo -e "  ${GREEN}‚óè –û–Ω–ª–∞–π–Ω${NC}"
        elif [ $diff -lt 3600 ]; then  # 1 —á–∞—Å
            echo -e "  ${YELLOW}‚óã –ë—ã–ª(–∞) –Ω–µ–¥–∞–≤–Ω–æ${NC}"
        else
            echo -e "  ${WHITE}‚óã –ù–µ –≤ —Å–µ—Ç–∏${NC}"
        fi
    else
        echo -e "  ${WHITE}‚óã –ù–µ –≤ —Å–µ—Ç–∏${NC}"
    fi
}

incoming_requests() {
    clear
    echo -e "${CYAN}"
    echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
    echo "‚ïë           –í–•–û–î–Ø–©–ò–ï –ó–ê–ü–†–û–°–´                       ‚ïë"
    echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
    echo -e "${NC}"
    
    requests=$(grep "|$USER_ID|pending|" "$REQUESTS_DB")
    
    if [ -z "$requests" ]; then
        echo -e "${YELLOW}[i] –ù–µ—Ç –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤${NC}"
    else
        echo -e "${GREEN}[‚úì] –í—Ö–æ–¥—è—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã:${NC}\n"
        
        IFS=$'\n'
        i=1
        for req in $requests; do
            request_id=$(echo "$req" | cut -d'|' -f1)
            from_user_id=$(echo "$req" | cut -d'|' -f2)
            message=$(echo "$req" | cut -d'|' -f6)
            timestamp=$(echo "$req" | cut -d'|' -f5)
            
            # –ü–æ–ª—É—á–∞–µ–º –∏–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
            from_user_name=$(grep "^[^|]*|.*|$from_user_id|" "$USERS_DB" | cut -d'|' -f1)
            
            echo -e "${BLUE}$i. –ó–∞–ø—Ä–æ—Å –æ—Ç: $from_user_name${NC}"
            echo -e "   ID: $from_user_id"
            echo -e "   –í—Ä–µ–º—è: $(date -d "@$timestamp" '+%H:%M %d.%m')"
            
            if [ -n "$message" ] && [ "$message" != "null" ]; then
                echo -e "   –°–æ–æ–±—â–µ–Ω–∏–µ: $message"
            fi
            
            echo -e "   ${YELLOW}1. –ü—Ä–∏–Ω—è—Ç—å    2. –û—Ç–∫–ª–æ–Ω–∏—Ç—å    3. –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å${NC}"
            echo ""
            i=$((i + 1))
        done
        unset IFS
        
        read -p "–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –¥–µ–π—Å—Ç–≤–∏—è (–Ω–æ–º–µ—Ä): " selected
        
        if [[ "$selected" =~ ^[0-9]+$ ]]; then
            selected_request=$(echo "$requests" | sed -n "${selected}p")
            
            if [ -n "$selected_request" ]; then
                handle_friend_request "$selected_request"
            fi
        fi
    fi
    
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter..."
}

handle_friend_request() {
    local request="$1"
    
    local request_id=$(echo "$request" | cut -d'|' -f1)
    local from_user_id=$(echo "$request" | cut -d'|' -f2)
    local from_user_name=$(grep "^[^|]*|.*|$from_user_id|" "$USERS_DB" | cut -d'|' -f1)
    
    echo -e "\n${YELLOW}–ó–∞–ø—Ä–æ—Å –æ—Ç: $from_user_name ($from_user_id)${NC}"
    echo "1. ‚úÖ –ü—Ä–∏–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å"
    echo "2. ‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å"
    echo "3. üëÅÔ∏è –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–æ—Ñ–∏–ª—å"
    echo "4. üìù –û—Ç–≤–µ—Ç–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ–º"
    echo "5. ‚¨ÖÔ∏è –ù–∞–∑–∞–¥"
    
    read -p "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ: " action
    
    case $action in
        1)
            # –ü—Ä–∏–Ω–∏–º–∞–µ–º –∑–∞–ø—Ä–æ—Å
            accept_friend_request "$request_id" "$from_user_id" "$from_user_name"
            ;;
        2)
            # –û—Ç–∫–ª–æ–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å
            reject_friend_request "$request_id" "$from_user_id"
            ;;
        3)
            # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å
            show_user_profile "$from_user_id"
            ;;
        4)
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            send_message_to_friend "$from_user_id" "$from_user_name"
            ;;
    esac
}

accept_friend_request() {
    local request_id="$1"
    local friend_id="$2"
    local friend_name="$3"
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –∑–∞–ø—Ä–æ—Å–∞
    sed -i "s/^$request_id|.*$/&|accepted|$(date +%s)/" "$REQUESTS_DB"
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤ –¥—Ä—É–∑—å—è
    echo "$USER_ID|$friend_id|$friend_name|accepted|$(date +%s)|$(date +%s)" >> "$FRIENDS_DB"
    echo "$friend_id|$USER_ID|$CURRENT_USER|accepted|$(date +%s)|$(date +%s)" >> "$FRIENDS_DB"
    
    # –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
    create_notification "$friend_id" "friend_accepted" \
        "$CURRENT_USER –ø—Ä–∏–Ω—è–ª(–∞) –≤–∞—à –∑–∞–ø—Ä–æ—Å –≤ –¥—Ä—É–∑—å—è!"
    
    echo -e "${GREEN}[‚úì] –í—ã –ø—Ä–∏–Ω—è–ª–∏ –∑–∞–ø—Ä–æ—Å –æ—Ç $friend_name!${NC}"
    echo -e "${YELLOW}[i] –¢–µ–ø–µ—Ä—å –≤—ã –¥—Ä—É–∑—å—è${NC}"
    
    log_system "FRIEND_ACCEPTED" "$CURRENT_USER –ø—Ä–∏–Ω—è–ª –∑–∞–ø—Ä–æ—Å –æ—Ç $friend_name" "INFO"
    
    # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç
    create_private_chat "$friend_id"
}

create_private_chat() {
    local friend_id="$1"
    local chat_id="CHAT_${USER_ID}_${friend_id}"
    
    CHATS_DIR="$DATA_DIR/chats"
    mkdir -p "$CHATS_DIR"
    
    local chat_file="$CHATS_DIR/$chat_id.txt"
    
    if [ ! -f "$chat_file" ]; then
        echo "Private chat between $USER_ID and $friend_id" > "$chat_file"
        echo "Created: $(date '+%Y-%m-%d %H:%M:%S')" >> "$chat_file"
        echo "========================================" >> "$chat_file"
    fi
}

chat_with_friend() {
    clear
    echo -e "${CYAN}"
    echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
    echo "‚ïë               –ß–ê–¢ –° –î–†–£–ì–û–ú                       ‚ïë"
    echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
    echo -e "${NC}"
    
    read -p "–í–≤–µ–¥–∏—Ç–µ ID –¥—Ä—É–≥–∞: " friend_id
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–∞–∫–æ–π –¥—Ä—É–≥
    if ! grep -q "^$USER_ID|$friend_id|accepted|" "$FRIENDS_DB"; then
        echo -e "${RED}[!] –≠—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ –≤–∞—à–µ–º —Å–ø–∏—Å–∫–µ –¥—Ä—É–∑–µ–π${NC}"
        read -p "–ù–∞–∂–º–∏—Ç–µ Enter..."
        return
    fi
    
    # –ü–æ–ª—É—á–∞–µ–º –∏–º—è –¥—Ä—É–≥–∞
    friend_name=$(grep "^[^|]*|.*|$friend_id|" "$USERS_DB" | cut -d'|' -f1)
    
    chat_id="CHAT_${USER_ID}_${friend_id}"
    CHATS_DIR="$DATA_DIR/chats"
    chat_file="$CHATS_DIR/$chat_id.txt"
    
    if [ ! -f "$chat_file" ]; then
        echo -e "${YELLOW}[i] –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —á–∞—Ç–∞...${NC}"
        echo "Private chat between $USER_ID and $friend_id" > "$chat_file"
        echo "Created: $(date '+%Y-%m-%d %H:%M:%S')" >> "$chat_file"
        echo "========================================" >> "$chat_file"
    fi
    
    clear
    echo -e "${GREEN}"
    echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
    echo "‚ïë           –ß–ê–¢ –° $friend_name"
    echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
    echo -e "${NC}"
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    echo -e "${CYAN}–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è:${NC}"
    tail -20 "$chat_file" | grep -v "^="
    
    echo -e "\n${YELLOW}[i] –í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (–∏–ª–∏ 'exit' –¥–ª—è –≤—ã—Ö–æ–¥–∞)${NC}"
    
    while true; do
        echo -ne "${GREEN}–í—ã: ${NC}"
        read message
        
        if [ "$message" = "exit" ]; then
            break
        fi
        
        if [ -n "$message" ]; then
            # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            echo "[$(date '+%H:%M')] $CURRENT_USER: $message" >> "$chat_file"
            
            # –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è
            update_last_interaction "$friend_id"
            
            # –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è –¥—Ä—É–≥–∞
            create_notification "$friend_id" "new_message" \
                "–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç $CURRENT_USER: $(echo "$message" | cut -c1-50)..."
            
            echo -e "${BLUE}[‚úì] –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ${NC}"
        fi
    done
}

update_last_interaction() {
    local friend_id="$1"
    local current_time=$(date +%s)
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —É —Å–µ–±—è
    sed -i "s/^$USER_ID|$friend_id|.*$/$USER_ID|$friend_id|$(grep "^$USER_ID|$friend_id|" "$FRIENDS_DB" | cut -d'|' -f3-5)|$current_time/" "$FRIENDS_DB"
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —É –¥—Ä—É–≥–∞ (–≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ –Ω—É–∂–Ω–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å)
    sed -i "s/^$friend_id|$USER_ID|.*$/$friend_id|$USER_ID|$(grep "^$friend_id|$USER_ID|" "$FRIENDS_DB" | cut -d'|' -f3-5)|$current_time/" "$FRIENDS_DB"
}

send_file_to_friend() {
    clear
    echo -e "${CYAN}"
    echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
    echo "‚ïë           –û–¢–ü–†–ê–í–ö–ê –§–ê–ô–õ–ê –î–†–£–ì–£                   ‚ïë"
    echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
    echo -e "${NC}"
    
    read -p "–í–≤–µ–¥–∏—Ç–µ ID –¥—Ä—É–≥–∞: " friend_id
    
    if ! grep -q "^$USER_ID|$friend_id|accepted|" "$FRIENDS_DB"; then
        echo -e "${RED}[!] –≠—Ç–æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –≤ –≤–∞—à–µ–º —Å–ø–∏—Å–∫–µ –¥—Ä—É–∑–µ–π${NC}"
        read -p "–ù–∞–∂–º–∏—Ç–µ Enter..."
        return
    fi
    
    read -p "–í–≤–µ–¥–∏—Ç–µ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É: " file_path
    
    if [ ! -f "$file_path" ]; then
        echo -e "${RED}[!] –§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω${NC}"
        read -p "–ù–∞–∂–º–∏—Ç–µ Enter..."
        return
    fi
    
    friend_name=$(grep "^[^|]*|.*|$friend_id|" "$USERS_DB" | cut -d'|' -f1)
    
    # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –æ–±–º–µ–Ω–∞ —Ñ–∞–π–ª–∞–º–∏
    FILES_DIR="$DATA_DIR/shared_files"
    mkdir -p "$FILES_DIR"
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞
    file_id="FILE_$(date +%s)_$RANDOM"
    file_ext="${file_path##*.}"
    new_filename="$FILES_DIR/${file_id}.${file_ext}"
    
    # –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª
    cp "$file_path" "$new_filename"
    
    # –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å –æ —Ñ–∞–π–ª–µ
    echo "$file_id|$USER_ID|$friend_id|$(basename "$file_path")|$(date +%s)|$new_filename|pending" >> "$DATA_DIR/shared_files.db"
    
    # –°–æ–∑–¥–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    create_notification "$friend_id" "file_shared" \
        "$CURRENT_USER –æ—Ç–ø—Ä–∞–≤–∏–ª(–∞) –≤–∞–º —Ñ–∞–π–ª: $(basename "$file_path")"
    
    echo -e "${GREEN}[‚úì] –§–∞–π–ª –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω $friend_name!${NC}"
    echo -e "${YELLOW}[i] –§–∞–π–ª –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Ä–∞–∑–¥–µ–ª–µ '–ü–æ–ª—É—á–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã'${NC}"
    
    log_system "FILE_SHARED" "$CURRENT_USER –æ—Ç–ø—Ä–∞–≤–∏–ª —Ñ–∞–π–ª $file_path –¥—Ä—É–≥—É $friend_name" "INFO"
    
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter..."
}

block_user_menu() {
    clear
    echo -e "${CYAN}"
    echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
    echo "‚ïë           –ë–õ–û–ö–ò–†–û–í–ö–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô              ‚ïë"
    echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
    echo -e "${NC}"
    
    echo "1. üö´ –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
    echo "2. üìã –°–ø–∏—Å–æ–∫ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö"
    echo "3. üîì –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
    echo "0. –ù–∞–∑–∞–¥"
    
    read -p "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ: " choice
    
    case $choice in
        1) block_user ;;
        2) show_blocked_users ;;
        3) unblock_user ;;
        0) return ;;
    esac
}

block_user() {
    read -p "–í–≤–µ–¥–∏—Ç–µ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏: " block_id
    
    if [ -z "$block_id" ]; then
        echo -e "${RED}[!] ID –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º${NC}"
        return
    fi
    
    if [ "$block_id" = "$USER_ID" ]; then
        echo -e "${RED}[!] –ù–µ–ª—å–∑—è –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–µ–±—è${NC}"
        return
    fi
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if ! grep -q "|$block_id|" "$USERS_DB"; then
        echo -e "${RED}[!] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω${NC}"
        return
    fi
    
    block_name=$(grep "^[^|]*|.*|$block_id|" "$USERS_DB" | cut -d'|' -f1)
    
    # –î–æ–±–∞–≤–ª—è–µ–º –≤ —á–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫
    BLOCKED_DB="$DATA_DIR/blocked.db"
    echo "$USER_ID|$block_id|$block_name|$(date +%s)|" >> "$BLOCKED_DB"
    
    # –£–¥–∞–ª—è–µ–º –∏–∑ –¥—Ä—É–∑–µ–π –µ—Å–ª–∏ –±—ã–ª–∏
    sed -i "/^$USER_ID|$block_id|/d" "$FRIENDS_DB"
    sed -i "/^$block_id|$USER_ID|/d" "$FRIENDS_DB"
    
    # –û—Ç–∫–ª–æ–Ω—è–µ–º –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã
    sed -i "s/\($USER_ID|$block_id|.*|\)pending/\1rejected/" "$REQUESTS_DB"
    sed -i "s/\($block_id|$USER_ID|.*|\)pending/\1rejected/" "$REQUESTS_DB"
    
    echo -e "${GREEN}[‚úì] –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å $block_name –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω${NC}"
    echo -e "${YELLOW}[i] –û–Ω –Ω–µ —Å–º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≤–∞–º —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –∑–∞–ø—Ä–æ—Å—ã${NC}"
    
    log_system "USER_BLOCKED" "$CURRENT_USER –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª $block_name" "WARN"
}

friends_settings() {
    clear
    echo -e "${CYAN}"
    echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
    echo "‚ïë           –ù–ê–°–¢–†–û–ô–ö–ò –î–†–£–ó–ï–ô                       ‚ïë"
    echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
    echo -e "${NC}"
    
    echo "1. üîî –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö"
    echo "2. üîí –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ—Ñ–∏–ª—è"
    echo "3. üëÅÔ∏è –ö—Ç–æ –º–æ–∂–µ—Ç –≤–∏–¥–µ—Ç—å —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π"
    echo "4. üìµ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–ø–∞–º–∞"
    echo "5. üíæ –≠–∫—Å–ø–æ—Ä—Ç —Å–ø–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π"
    echo "0. –ù–∞–∑–∞–¥"
    
    read -p "–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫—É: " choice
    
    case $choice in
        1) 
            echo -e "${GREEN}[‚úì] –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–∫–ª—é—á–µ–Ω—ã${NC}"
            ;;
        5)
            export_friends_list
            ;;
    esac
    
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter..."
}

export_friends_list() {
    local export_file="$HOME/friends_export_$(date +%Y%m%d).txt"
    
    echo "–°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π - $CURRENT_USER" > "$export_file"
    echo "–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ: $(date '+%Y-%m-%d %H:%M:%S')" >> "$export_file"
    echo "========================================" >> "$export_file"
    
    grep "^$USER_ID|" "$FRIENDS_DB" | grep "|accepted|" | while read -r friend; do
        friend_id=$(echo "$friend" | cut -d'|' -f2)
        friend_name=$(echo "$friend" | cut -d'|' -f3)
        since=$(echo "$friend" | cut -d'|' -f5)
        
        echo "–ò–º—è: $friend_name" >> "$export_file"
        echo "ID: $friend_id" >> "$export_file"
        echo "–í –¥—Ä—É–∑—å—è—Ö —Å: $(date -d "@$since" '+%d.%m.%Y')" >> "$export_file"
        echo "---" >> "$export_file"
    done
    
    echo -e "${GREEN}[‚úì] –°–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤: $export_file${NC}"
}
# –í account_menu():
echo "6. üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–∑—å—è–º–∏"
echo "7. üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–∫–∫–∞—É–Ω—Ç–∞"

# –ò –≤ case:
6) friends_menu ;;
