#!/bin/bash

# Terminal : Encryptor v1.1
# Автор: terminaldestrroyrr
# Telegram: @bred37
# Лицензия: MIT License

# ==================== КОНФИГУРАЦИЯ ====================
VERSION="1.1"
APP_NAME="Terminal : Encryptor"
AUTHOR="terminaldestrroyrr"
TELEGRAM="@bred37"
LICENSE="MIT License"

# Директории
BASE_DIR="$HOME/.terminal_encryptor"
mkdir -p "$BASE_DIR"
CONF_DIR="$BASE_DIR/config"
DATA_DIR="$BASE_DIR/data"
BACKUP_DIR="$BASE_DIR/backup"
LOGS_DIR="$BASE_DIR/logs"
TEMP_DIR="/tmp/terminal_encryptor"

mkdir -p "$CONF_DIR" "$DATA_DIR" "$BACKUP_DIR" "$LOGS_DIR" "$TEMP_DIR"

# Файлы базы данных
USERS_DB="$DATA_DIR/users.dat"
CHANNELS_DB="$DATA_DIR/channels.dat"
NETWORKS_DB="$DATA_DIR/networks.dat"
MESSAGES_DB="$DATA_DIR/messages.dat"
ENCRYPTION_DB="$DATA_DIR/encryption_keys.dat"
SESSION_FILE="$TEMP_DIR/session"
LOG_FILE="$LOGS_DIR/app.log"

# Конфигурационные файлы
APP_CONFIG="$CONF_DIR/app.cfg"
CRYPTO_CONFIG="$CONF_DIR/crypto.cfg"
UI_CONFIG="$CONF_DIR/ui.cfg"

# Цвета
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
WHITE='\033[1;37m'
ORANGE='\033[38;5;214m'
BG_BLACK='\033[40m'
BG_RED='\033[41m'
BG_GREEN='\033[42m'
NC='\033[0m'

# Глобальные переменные
CURRENT_USER=""
USER_ID=""
SESSION_TOKEN=""
USER_ROLE="user"
USER_IP=""
LANGUAGE="ru"

# ==================== ИНИЦИАЛИЗАЦИЯ ====================
init_system() {
    clear
    echo -e "${PURPLE}"
    echo "╔══════════════════════════════════════════════════╗"
    echo "║                                                  ║"
    echo "║          TERMINAL : ENCRYPTOR v1.1              ║"
    echo "║           Author: terminaldestrroyrr             ║"
    echo "║            Telegram: @bred37                    ║"
    echo "║                                                  ║"
    echo "╚══════════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    # Проверка зависимостей
    check_dependencies
    
    # Создание файлов если не существуют
    for file in "$USERS_DB" "$CHANNELS_DB" "$NETWORKS_DB" "$MESSAGES_DB" "$ENCRYPTION_DB"; do
        if [ ! -f "$file" ]; then
            touch "$file"
        fi
    done
    
    # Конфигурация по умолчанию
    if [ ! -f "$APP_CONFIG" ]; then
        cat > "$APP_CONFIG" << EOF
# Terminal : Encryptor Configuration
version=1.1
auto_backup=true
log_level=normal
max_login_attempts=3
session_timeout=3600
encryption_method=aes-256
EOF
    fi
    
    if [ ! -f "$CRYPTO_CONFIG" ]; then
        cat > "$CRYPTO_CONFIG" << EOF
# Cryptography Configuration
default_cipher=aes-256-cbc
hash_algorithm=sha256
key_length=32
iv_length=16
salt_length=16
EOF
    fi
    
    # Определение IP
    detect_ip
    
    # Генерация сессионного токена
    SESSION_TOKEN=$(generate_token)
    
    log_system "SYSTEM_INIT" "Система инициализирована" "INFO"
    
    echo -e "\n${GREEN}[✓] Система готова к работе${NC}"
    sleep 1
}

check_dependencies() {
    local missing=()
    
    # Проверка базовых утилит
    for cmd in openssl base64 md5sum sha256sum awk sed grep; do
        if ! command -v $cmd &> /dev/null; then
            missing+=($cmd)
        fi
    done
    
    if [ ${#missing[@]} -gt 0 ]; then
        echo -e "${RED}[!] Отсутствуют зависимости: ${missing[*]}${NC}"
        echo -e "${YELLOW}[?] Установите их командой: pkg install ${missing[*]}${NC}"
        read -p "Продолжить без них? (y/n): " choice
        if [ "$choice" != "y" ]; then
            exit 1
        fi
    fi
}

detect_ip() {
    if command -v ip &> /dev/null; then
        USER_IP=$(ip route get 1 | awk '{print $7; exit}')
    elif command -v ifconfig &> /dev/null; then
        USER_IP=$(ifconfig | grep -Eo 'inet (addr:)?([0-9]*\.){3}[0-9]*' | grep -Eo '([0-9]*\.){3}[0-9]*' | grep -v '127.0.0.1' | head -1)
    else
        USER_IP="127.0.0.1"
    fi
    
    if [ -z "$USER_IP" ]; then
        USER_IP="127.0.0.1"
    fi
}

generate_token() {
    echo "$(date +%s)$RANDOM" | md5sum | cut -d' ' -f1
}

log_system() {
    local type=$1
    local message=$2
    local level=$3
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    echo "[$timestamp] [$level] [$type] $message" >> "$LOG_FILE"
}

# ==================== АУТЕНТИФИКАЦИЯ ====================
show_login_menu() {
    while true; do
        clear
        echo -e "${CYAN}"
        echo "╔══════════════════════════════════════════════════╗"
        echo "║           ТЕРМИНАЛ : ШИФРОВАТОР v1.1            ║"
        echo "╠══════════════════════════════════════════════════╣"
        echo "║                                                  ║"
        echo "║  1. 🔐 Вход в систему                           ║"
        echo "║  2. 📝 Регистрация                              ║"
        echo "║  3. 🔑 Восстановление доступа                   ║"
        echo "║  4. ℹ️  О программе                              ║"
        echo "║  5. ⚙️  Настройки                                ║"
        echo "║  0. 🚪 Выход                                    ║"
        echo "║                                                  ║"
        echo "╚══════════════════════════════════════════════════╝"
        echo -e "${NC}"
        
        read -p "Выберите действие: " choice
        
        case $choice in
            1) user_login ;;
            2) user_register ;;
            3) password_recovery ;;
            4) show_about ;;
            5) system_settings ;;
            0) exit_app ;;
            *) echo -e "${RED}[!] Неверный выбор${NC}"; sleep 1 ;;
        esac
    done
}

user_register() {
    clear
    echo -e "${CYAN}"
    echo "╔══════════════════════════════════════════════════╗"
    echo "║                 РЕГИСТРАЦИЯ                      ║"
    echo "╚══════════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    # Генерация уникального ID
    USER_ID="USER_$(date +%s)_$RANDOM"
    
    while true; do
        read -p "Введите имя пользователя (3-20 символов): " username
        
        if [ ${#username} -lt 3 ] || [ ${#username} -gt 20 ]; then
            echo -e "${RED}[!] Имя должно быть от 3 до 20 символов${NC}"
            continue
        fi
        
        # Проверка существования пользователя
        if grep -q "^$username|" "$USERS_DB"; then
            echo -e "${RED}[!] Пользователь уже существует${NC}"
            continue
        fi
        
        break
    done
    
    while true; do
        read -sp "Введите пароль (мин. 8 символов): " password
        echo
        if [ ${#password} -lt 8 ]; then
            echo -e "${RED}[!] Пароль должен быть не менее 8 символов${NC}"
            continue
        fi
        
        read -sp "Подтвердите пароль: " password_confirm
        echo
        if [ "$password" != "$password_confirm" ]; then
            echo -e "${RED}[!] Пароли не совпадают${NC}"
            continue
        fi
        
        # Проверка сложности пароля
        if ! [[ "$password" =~ [A-Z] ]] || ! [[ "$password" =~ [0-9] ]]; then
            echo -e "${YELLOW}[!] Рекомендуется использовать заглавные буквы и цифры${NC}"
            read -p "Продолжить? (y/n): " weak_pass
            if [ "$weak_pass" != "y" ]; then
                continue
            fi
        fi
        break
    done
    
    # Хэширование пароля
    password_hash=$(echo -n "${password}${USER_ID}" | sha256sum | cut -d' ' -f1)
    
    # Сохранение пользователя
    user_data="$username|$password_hash|$USER_ID|user|$(date +%s)|$USER_IP|active"
    echo "$user_data" >> "$USERS_DB"
    
    echo -e "\n${GREEN}[✓] Регистрация успешна!${NC}"
    echo -e "${YELLOW}[i] Ваш ID: $USER_ID${NC}"
    echo -e "${YELLOW}[i] Сохраните его для восстановления${NC}"
    
    log_system "USER_REGISTER" "Зарегистрирован: $username" "INFO"
    
    read -p "Нажмите Enter для входа..."
    CURRENT_USER="$username"
    show_main_menu
}

user_login() {
    clear
    echo -e "${CYAN}"
    echo "╔══════════════════════════════════════════════════╗"
    echo "║                   ВХОД В СИСТЕМУ                 ║"
    echo "╚══════════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    local attempts=0
    local max_attempts=$(grep "max_login_attempts" "$APP_CONFIG" | cut -d= -f2)
    
    while [ $attempts -lt $max_attempts ]; do
        read -p "Имя пользователя: " username
        read -sp "Пароль: " password
        echo
        
        # Поиск пользователя
        if ! grep -q "^$username|" "$USERS_DB"; then
            echo -e "${RED}[!] Пользователь не найден${NC}"
            ((attempts++))
            continue
        fi
        
        # Получение данных пользователя
        user_line=$(grep "^$username|" "$USERS_DB")
        stored_hash=$(echo "$user_line" | cut -d'|' -f2)
        user_id=$(echo "$user_line" | cut -d'|' -f3)
        status=$(echo "$user_line" | cut -d'|' -f7)
        
        # Проверка статуса
        if [ "$status" != "active" ]; then
            echo -e "${RED}[!] Аккаунт заблокирован${NC}"
            break
        fi
        
        # Проверка пароля
        input_hash=$(echo -n "${password}${user_id}" | sha256sum | cut -d' ' -f1)
        
        if [ "$input_hash" = "$stored_hash" ]; then
            CURRENT_USER="$username"
            USER_ID="$user_id"
            USER_ROLE=$(echo "$user_line" | cut -d'|' -f4)
            
            # Обновление последнего входа
            sed -i "/^$username|/d" "$USERS_DB"
            new_data="$username|$stored_hash|$user_id|$USER_ROLE|$(date +%s)|$USER_IP|active"
            echo "$new_data" >> "$USERS_DB"
            
            echo -e "\n${GREEN}[✓] Авторизация успешна!${NC}"
            log_system "USER_LOGIN" "Вход: $username" "INFO"
            sleep 1
            show_main_menu
            return
        else
            echo -e "${RED}[!] Неверный пароль${NC}"
            ((attempts++))
            echo -e "${YELLOW}[i] Осталось попыток: $((max_attempts - attempts))${NC}"
        fi
    done
    
    if [ $attempts -ge $max_attempts ]; then
        echo -e "${RED}[!] Слишком много неудачных попыток${NC}"
        log_system "LOGIN_FAILED" "Много попыток для: $username" "WARN"
    fi
    
    read -p "Нажмите Enter для продолжения..."
}

# ==================== ГЛАВНОЕ МЕНЮ ====================
show_main_menu() {
    while true; do
        clear
        echo -e "${GREEN}"
        echo "╔══════════════════════════════════════════════════╗"
        echo "║           ТЕРМИНАЛ : ШИФРОВАТОР v1.1            ║"
        echo "╠══════════════════════════════════════════════════╣"
        echo "║  Пользователь: $CURRENT_USER"
        echo "║  ID: $USER_ID"
        echo "║  Роль: $USER_ROLE"
        echo "║  IP: $USER_IP"
        echo "╠══════════════════════════════════════════════════╣"
        echo "║                                                  ║"
        echo "║  1. 🔐 ШИФРОВАНИЕ И ДЕШИФРОВАНИЕ                ║"
        echo "║  2. 📡 УПРАВЛЕНИЕ КАНАЛАМИ                      ║"
        echo "║  3. 🌐 УПРАВЛЕНИЕ СЕТЯМИ                        ║"
        echo "║  4. 📁 ФАЙЛОВЫЙ МЕНЕДЖЕР                        ║"
        echo "║  5. 🛡️  БЕЗОПАСНОСТЬ И АУДИТ                    ║"
        echo "║  6. ⚙️  НАСТРОЙКИ СИСТЕМЫ                       ║"
        echo "║  7. 👤 МОЙ АККАУНТ                              ║"
        echo "║  8. 📊 СТАТИСТИКА                               ║"
        echo "║  9. 🆘 ПОМОЩЬ И ПОДДЕРЖКА                       ║"
        echo "║  0. 🚪 ВЫХОД                                    ║"
        echo "║                                                  ║"
        echo "╚══════════════════════════════════════════════════╝"
        echo -e "${NC}"
        
        read -p "Выберите раздел: " choice
        
        case $choice in
            1) encryption_menu ;;
            2) channels_menu ;;
            3) networks_menu ;;
            4) file_manager_menu ;;
            5) security_menu ;;
            6) system_settings ;;
            7) account_menu ;;
            8) statistics_menu ;;
            9) help_menu ;;
            0) logout_user ;;
            *) echo -e "${RED}[!] Неверный выбор${NC}"; sleep 1 ;;
        esac
    done
}

# ==================== МЕНЮ ШИФРОВАНИЯ ====================
encryption_menu() {
    while true; do
        clear
        echo -e "${CYAN}"
        echo "╔══════════════════════════════════════════════════╗"
        echo "║           ШИФРОВАНИЕ И ДЕШИФРОВАНИЕ             ║"
        echo "╠══════════════════════════════════════════════════╣"
        echo "║                                                  ║"
        echo "║  1. 📝 Шифровать текст                          ║"
        echo "║  2. 📝 Дешифровать текст                        ║"
        echo "║  3. 🔢 Шифровать числа                          ║"
        echo "║  4. 🔢 Дешифровать числа                        ║"
        echo "║  5. 🌐 Шифровать IP-адрес                       ║"
        echo "║  6. 🌐 Дешифровать IP-адрес                     ║"
        echo "║  7. 📁 Шифровать файл                           ║"
        echo "║  8. 📁 Дешифровать файл                         ║"
        echo "║  9. 🎲 Генератор паролей                        ║"
        echo "║ 10. 🗝️  Генератор ключей                         ║"
        echo "║ 11. 🛠️  Настройки шифрования                     ║"
        echo "║  0. ↩️  Назад                                    ║"
        echo "║                                                  ║"
        echo "╚══════════════════════════════════════════════════╝"
        echo -e "${NC}"
        
        read -p "Выберите действие: " choice
        
        case $choice in
            1) encrypt_text ;;
            2) decrypt_text ;;
            3) encrypt_numbers ;;
            4) decrypt_numbers ;;
            5) encrypt_ip ;;
            6) decrypt_ip ;;
            7) encrypt_file ;;
            8) decrypt_file ;;
            9) password_generator ;;
            10) key_generator ;;
            11) encryption_settings ;;
            0) return ;;
            *) echo -e "${RED}[!] Неверный выбор${NC}"; sleep 1 ;;
        esac
    done
}

encrypt_text() {
    clear
    echo -e "${CYAN}"
    echo "╔══════════════════════════════════════════════════╗"
    echo "║               ШИФРОВАНИЕ ТЕКСТА                  ║"
    echo "╚══════════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    echo -e "${YELLOW}[i] Выберите метод шифрования:${NC}"
    echo "1. AES-256 (рекомендуется)"
    echo "2. XOR шифрование"
    echo "3. Base64 + ROT13"
    echo "4. Кастомный алгоритм"
    
    read -p "Выбор: " method
    
    read -p "Введите текст для шифрования: " text
    
    case $method in
        1)
            # AES-256 шифрование
            read -sp "Введите ключ шифрования (оставьте пустым для генерации): " key
            echo
            if [ -z "$key" ]; then
                key=$(openssl rand -hex 32)
                echo -e "${GREEN}[✓] Сгенерирован ключ: $key${NC}"
                echo -e "${RED}[!] Сохраните этот ключ!${NC}"
            fi
            
            encrypted=$(echo -n "$text" | openssl enc -aes-256-cbc -a -salt -pbkdf2 -pass pass:"$key" 2>/dev/null)
            if [ $? -eq 0 ]; then
                echo -e "\n${GREEN}[✓] Текст зашифрован:${NC}"
                echo "$encrypted"
                
                # Сохранение в базу
                echo "$(date +%s)|$CURRENT_USER|aes256|$encrypted|$key" >> "$ENCRYPTION_DB"
            else
                echo -e "${RED}[!] Ошибка шифрования${NC}"
            fi
            ;;
        2)
            # XOR шифрование
            read -sp "Введите ключ: " xor_key
            echo
            encrypted=$(xor_encrypt "$text" "$xor_key")
            echo -e "\n${GREEN}[✓] Текст зашифрован:${NC}"
            echo "$encrypted"
            ;;
        3)
            # Base64 + ROT13
            encrypted=$(echo -n "$text" | tr 'A-Za-z' 'N-ZA-Mn-za-m' | base64)
            echo -e "\n${GREEN}[✓] Текст зашифрован:${NC}"
            echo "$encrypted"
            ;;
        4)
            # Кастомный алгоритм
            encrypted=$(custom_encrypt "$text")
            echo -e "\n${GREEN}[✓] Текст зашифрован:${NC}"
            echo "$encrypted"
            ;;
    esac
    
    echo -e "\n${YELLOW}[i] Сохранить в файл? (y/n): ${NC}"
    read save_choice
    if [ "$save_choice" = "y" ]; then
        filename="encrypted_$(date +%s).txt"
        echo "$encrypted" > "$filename"
        echo -e "${GREEN}[✓] Сохранено в $filename${NC}"
    fi
    
    read -p "Нажмите Enter для продолжения..."
}

xor_encrypt() {
    local text="$1"
    local key="$2"
    local result=""
    
    for ((i=0; i<${#text}; i++)); do
        char="${text:$i:1}"
        key_char="${key:$((i % ${#key})):1}"
        ascii_val=$(printf '%d' "'$char")
        key_val=$(printf '%d' "'$key_char")
        xor_val=$((ascii_val ^ key_val))
        result+=$(printf '\\x%02x' "$xor_val")
    done
    
    echo -n "$result" | xxd -p
}

custom_encrypt() {
    local text="$1"
    # Сложный кастомный алгоритм
    echo -n "$text" | \
        rev | \
        tr 'A-Za-z' 'N-ZA-Mn-za-m' | \
        base64 | \
        tr 'A-Za-z0-9+/' '9+8/7zyxwvutsrqponmlkjihgfedcbaZYXWVUTSRQPONMLKJIHGFEDCBA6543210'
}

# ==================== МЕНЮ КАНАЛОВ ====================
channels_menu() {
    while true; do
        clear
        echo -e "${CYAN}"
        echo "╔══════════════════════════════════════════════════╗"
        echo "║           УПРАВЛЕНИЕ КАНАЛАМИ                   ║"
        echo "╠══════════════════════════════════════════════════╣"
        echo "║                                                  ║"
        echo "║  1. ➕ Создать канал                            ║"
        echo "║  2. ❌ Удалить канал                            ║"
        echo "║  3. 🔗 Подключиться к каналу                    ║"
        echo "║  4. 🌐 Изменить IP канала                       ║"
        echo "║  5. 👥 Управление пользователями                ║"
        echo "║  6. 👁️  Просмотр канала                         ║"
        echo "║  7. 📡 Создать сетевой канал                    ║"
        echo "║  8. 🏠 Создать локальный канал                  ║"
        echo "║  9. 📊 Список каналов                           ║"
        echo "║ 10. ⚙️  Настройки канала                         ║"
        echo "║  0. ↩️  Назад                                    ║"
        echo "║                                                  ║"
        echo "╚══════════════════════════════════════════════════╝"
        echo -e "${NC}"
        
        read -p "Выберите действие: " choice
        
        case $choice in
            1) create_channel ;;
            2) delete_channel ;;
            3) join_channel ;;
            4) change_channel_ip ;;
            5) manage_channel_users ;;
            6) view_channel ;;
            7) create_network_channel ;;
            8) create_local_channel ;;
            9) list_channels ;;
            10) channel_settings ;;
            0) return ;;
            *) echo -e "${RED}[!] Неверный выбор${NC}"; sleep 1 ;;
        esac
    done
}

create_channel() {
    clear
    echo -e "${CYAN}"
    echo "╔══════════════════════════════════════════════════╗"
    echo "║               СОЗДАНИЕ КАНАЛА                    ║"
    echo "╚══════════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    read -p "Название канала: " channel_name
    read -p "Описание: " channel_desc
    
    echo -e "\n${YELLOW}[i] Выберите тип канала:${NC}"
    echo "1. Открытый (публичный)"
    echo "2. Приватный (по приглашению)"
    echo "3. Скрытый"
    read -p "Выбор: " channel_type
    
    # Генерация уникального ID
    channel_id="CH_$(date +%s)_$RANDOM"
    
    # Генерация IP
    if [ "$channel_type" = "3" ]; then
        # Скрытый канал - внутренний IP
        channel_ip="10.$((RANDOM % 255)).$((RANDOM % 255)).1"
    else
        # Публичный канал
        channel_ip="$((RANDOM % 255)).$((RANDOM % 255)).$((RANDOM % 255)).$((RANDOM % 254 + 1))"
    fi
    
    # Генерация пароля
    channel_pass=$(generate_password 12)
    
    # Сохранение канала
    channel_data="$channel_id|$channel_name|$channel_desc|$channel_ip|$channel_pass|$CURRENT_USER|$(date +%s)|$channel_type|active"
    echo "$channel_data" >> "$CHANNELS_DB"
    
    echo -e "\n${GREEN}[✓] Канал создан успешно!${NC}"
    echo -e "${YELLOW}Детали канала:${NC}"
    echo "  ID: $channel_id"
    echo "  Название: $channel_name"
    echo "  IP: $channel_ip"
    echo "  Пароль: $channel_pass"
    echo -e "${RED}[!] Сохраните эти данные!${NC}"
    
    log_system "CHANNEL_CREATE" "Создан канал: $channel_name ($channel_id)" "INFO"
    
    read -p "Нажмите Enter для продолжения..."
}

generate_password() {
    local length=${1:-12}
    tr -dc 'A-Za-z0-9!@#$%^&*()_+' < /dev/urandom | head -c "$length"
}

# ==================== МЕНЮ СЕТЕЙ ====================
networks_menu() {
    while true; do
        clear
        echo -e "${CYAN}"
        echo "╔══════════════════════════════════════════════════╗"
        echo "║             УПРАВЛЕНИЕ СЕТЯМИ                   ║"
        echo "╠══════════════════════════════════════════════════╣"
        echo "║                                                  ║"
        echo "║  1. 🌐 Создать сеть                             ║"
        echo "║  2. 🏠 Создать локальную сеть                   ║"
        echo "║  3. ❌ Удалить сеть                             ║"
        echo "║  4. 📡 Подключиться к сети                      ║"
        echo "║  5. 📋 Список сетей                             ║"
        echo "║  6. 🔄 Обновить сетевые настройки               ║"
        echo "║  7. 🛡️  Защита сети                             ║"
        echo "║  8. 📊 Мониторинг сети                          ║"
        echo "║  9. 🤝 Поделиться сетью                         ║"
        echo "║ 10. ⚙️  Настройки сети                           ║"
        echo "║  0. ↩️  Назад                                    ║"
        echo "║                                                  ║"
        echo "╚══════════════════════════════════════════════════╝"
        echo -e "${NC}"
        
        read -p "Выберите действие: " choice
        
        case $choice in
            1) create_network ;;
            2) create_local_network ;;
            3) delete_network ;;
            4) join_network ;;
            5) list_networks ;;
            6) update_network_settings ;;
            7) network_security ;;
            8) network_monitor ;;
            9) share_network ;;
            10) network_settings ;;
            0) return ;;
            *) echo -e "${RED}[!] Неверный выбор${NC}"; sleep 1 ;;
        esac
    done
}

create_network() {
    clear
    echo -e "${CYAN}"
    echo "╔══════════════════════════════════════════════════╗"
    echo "║               СОЗДАНИЕ СЕТИ                      ║"
    echo "╚══════════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    read -p "Название сети: " network_name
    read -p "Описание: " network_desc
    
    echo -e "\n${YELLOW}[i] Выберите тип сети:${NC}"
    echo "1. Публичная (открытая)"
    echo "2. Приватная (закрытая)"
    echo "3. Скрытая (только по приглашению)"
    read -p "Выбор: " network_type
    
    # Генерация сетевых данных
    network_id="NET_$(date +%s)_$RANDOM"
    network_ip="172.$((RANDOM % 16 + 16)).$((RANDOM % 255)).0/24"
    network_key=$(generate_password 16)
    
    # Сохранение сети
    network_data="$network_id|$network_name|$network_desc|$network_ip|$network_key|$CURRENT_USER|$(date +%s)|$network_type|active|0"
    echo "$network_data" >> "$NETWORKS_DB"
    
    echo -e "\n${GREEN}[✓] Сеть создана успешно!${NC}"
    echo -e "${YELLOW}Детали сети:${NC}"
    echo "  ID: $network_id"
    echo "  Название: $network_name"
    echo "  IP диапазон: $network_ip"
    echo "  Ключ доступа: $network_key"
    echo -e "${RED}[!] Сохраните ключ доступа!${NC}"
    
    log_system "NETWORK_CREATE" "Создана сеть: $network_name ($network_id)" "INFO"
    
    read -p "Нажмите Enter для продолжения..."
}

# ==================== ФАЙЛОВЫЙ МЕНЕДЖЕР ====================
file_manager_menu() {
    while true; do
        clear
        echo -e "${CYAN}"
        echo "╔══════════════════════════════════════════════════╗"
        echo "║             ФАЙЛОВЫЙ МЕНЕДЖЕР                   ║"
        echo "╠══════════════════════════════════════════════════╣"
        echo "║                                                  ║"
        echo "║  1. 📁 Просмотр файлов                          ║"
        echo "║  2. 🔐 Шифровать файл                           ║"
        echo "║  3. 🔓 Дешифровать файл                         ║"
        echo "║  4. 📤 Загрузить файл                           ║"
        echo "║  5. 📥 Скачать файл                             ║"
        echo "║  6. 🗑️  Удалить файл                            ║"
        echo "║  7. 📝 Редактировать файл                       ║"
        echo "║  8. 🔍 Поиск файлов                             ║"
        echo "║  9. 📊 Информация о файле                       ║"
        echo "║ 10. 🏷️  Переименовать файл                      ║"
        echo "║ 11. 📂 Создать папку                            ║"
        echo "║  0. ↩️  Назад                                    ║"
        echo "║                                                  ║"
        echo "╚══════════════════════════════════════════════════╝"
        echo -e "${NC}"
        
        read -p "Выберите действие: " choice
        
        case $choice in
            1) list_files ;;
            2) encrypt_file ;;
            3) decrypt_file ;;
            4) upload_file ;;
            5) download_file ;;
            6) delete_file ;;
            7) edit_file ;;
            8) search_files ;;
            9) file_info ;;
            10) rename_file ;;
            11) create_folder ;;
            0) return ;;
            *) echo -e "${RED}[!] Неверный выбор${NC}"; sleep 1 ;;
        esac
    done
}

encrypt_file() {
    clear
    echo -e "${CYAN}"
    echo "╔══════════════════════════════════════════════════╗"
    echo "║               ШИФРОВАНИЕ ФАЙЛА                   ║"
    echo "╚══════════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    read -p "Введите путь к файлу: " filepath
    
    if [ ! -f "$filepath" ]; then
        echo -e "${RED}[!] Файл не найден${NC}"
        read -p "Нажмите Enter..."
        return
    fi
    
    echo -e "${YELLOW}[i] Выберите метод шифрования:${NC}"
    echo "1. AES-256 (быстро и безопасно)"
    echo "2. Blowfish (высокая безопасность)"
    echo "3. ChaCha20 (современный)"
    echo "4. Кастомный алгоритм"
    
    read -p "Выбор: " method
    
    read -sp "Введите ключ шифрования: " key
    echo
    
    # Определение выходного файла
    output_file="${filepath}.enc"
    
    case $method in
        1)
            openssl enc -aes-256-cbc -salt -in "$filepath" -out "$output_file" -pbkdf2 -pass pass:"$key"
            ;;
        2)
            openssl enc -bf-cbc -salt -in "$filepath" -out "$output_file" -pbkdf2 -pass pass:"$key"
            ;;
        3)
            openssl enc -chacha20 -salt -in "$filepath" -out "$output_file" -pbkdf2 -pass pass:"$key"
            ;;
        4)
            # Кастомный алгоритм: XOR + Base64
            cat "$filepath" | while IFS= read -r line; do
                echo "$line" | tr 'A-Za-z' 'N-ZA-Mn-za-m'
            done | base64 > "$output_file"
            ;;
    esac
    
    if [ $? -eq 0 ]; then
        echo -e "\n${GREEN}[✓] Файл успешно зашифрован${NC}"
        echo -e "${YELLOW}[i] Результат: $output_file${NC}"
        
        # Запись в лог
        file_size=$(stat -c%s "$filepath")
        echo "$(date +%s)|$CURRENT_USER|encrypt|$filepath|$output_file|$file_size|$method" >> "$FILES_DB"
        
        echo -e "\n${YELLOW}[i] Удалить оригинальный файл? (y/n): ${NC}"
        read delete_choice
        if [ "$delete_choice" = "y" ]; then
            shred -u "$filepath"
            echo -e "${GREEN}[✓] Оригинальный файл удален${NC}"
        fi
    else
        echo -e "${RED}[!] Ошибка шифрования${NC}"
    fi
    
    read -p "Нажмите Enter..."
}

# ==================== БЕЗОПАСНОСТЬ И АУДИТ ====================
security_menu() {
    while true; do
        clear
        echo -e "${CYAN}"
        echo "╔══════════════════════════════════════════════════╗"
        echo "║           БЕЗОПАСНОСТЬ И АУДИТ                  ║"
        echo "╠══════════════════════════════════════════════════╣"
        echo "║                                                  ║"
        echo "║  1. 📋 Журнал безопасности                      ║"
        echo "║  2. 🔍 Аудит системы                            ║"
        echo "║  3. 🛡️  Сканирование угроз                      ║"
        echo "║  4. 🚨 Мониторинг активности                    ║"
        echo "║  5. 🔐 Проверка паролей                         ║"
        echo "║  6. 🛠️  Диагностика системы                     ║"
        echo "║  7. 📊 Отчет безопасности                       ║"
        echo "║  8. 🧹 Очистка логов                            ║"
        echo "║  9. ⚠️  Проверка уязвимостей                     ║"
        echo "║ 10. 🎯 Тестирование на проникновение            ║"
        echo "║  0. ↩️  Назад                                    ║"
        echo "║                                                  ║"
        echo "╚══════════════════════════════════════════════════╝"
        echo -e "${NC}"
        
        read -p "Выберите действие: " choice
        
        case $choice in
            1) view_security_log ;;
            2) system_audit ;;
            3) threat_scan ;;
            4) activity_monitor ;;
            5) password_check ;;
            6) system_diagnostics ;;
            7) security_report ;;
            8) clear_logs ;;
            9) vulnerability_scan ;;
            10) penetration_test ;;
            0) return ;;
            *) echo -e "${RED}[!] Неверный выбор${NC}"; sleep 1 ;;
        esac
    done
}

system_audit() {
    clear
    echo -e "${CYAN}"
    echo "╔══════════════════════════════════════════════════╗"
    echo "║               АУДИТ СИСТЕМЫ                      ║"
    echo "╚══════════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    echo -e "${YELLOW}[i] Запуск аудита системы...${NC}"
    
    # Проверка файлов
    echo -e "\n${BLUE}[1] Проверка файлов системы:${NC}"
    echo -e "Конфигурационные файлы:"
    ls -la "$CONF_DIR/"
    echo -e "\nБазы данных:"
    ls -la "$DATA_DIR/"
    
    # Проверка пользователей
    echo -e "\n${BLUE}[2] Проверка пользователей:${NC}"
    user_count=$(wc -l < "$USERS_DB")
    echo "Всего пользователей: $user_count"
    
    # Проверка каналов
    echo -e "\n${BLUE}[3] Проверка каналов:${NC}"
    channel_count=$(wc -l < "$CHANNELS_DB")
    echo "Всего каналов: $channel_count"
    
    # Проверка сетей
    echo -e "\n${BLUE}[4] Проверка сетей:${NC}"
    network_count=$(wc -l < "$NETWORKS_DB")
    echo "Всего сетей: $network_count"
    
    # Проверка логов
    echo -e "\n${BLUE}[5] Проверка логов:${NC}"
    log_size=$(wc -c < "$LOG_FILE")
    echo "Размер лог-файла: $((log_size / 1024)) KB"
    
    # Проверка безопасности
    echo -e "\n${BLUE}[6] Проверка безопасности:${NC}"
    if [ -f "$SESSION_FILE" ]; then
        echo "⚠️  Обнаружен файл сессии"
    else
        echo "✓ Файл сессии не найден"
    fi
    
    # Рекомендации
    echo -e "\n${GREEN}[✓] Аудит завершен${NC}"
    echo -e "${YELLOW}[i] Рекомендации:${NC}"
    echo "1. Регулярно меняйте пароли"
    echo "2. Очищайте логи"
    echo "3. Обновляйте систему"
    echo "4. Проверяйте подозрительную активность"
    
    log_system "SYSTEM_AUDIT" "Проведен аудит системы" "INFO"
    
    read -p "Нажмите Enter..."
}

# ==================== НАСТРОЙКИ СИСТЕМЫ ====================
system_settings() {
    while true; do
        clear
        echo -e "${CYAN}"
        echo "╔══════════════════════════════════════════════════╗"
        echo "║             НАСТРОЙКИ СИСТЕМЫ                   ║"
        echo "╠══════════════════════════════════════════════════╣"
        echo "║                                                  ║"
        echo "║  1. 🌐 Настройки сети                           ║"
        echo "║  2. 🔐 Настройки безопасности                   ║"
        echo "║  3. 🎨 Настройки интерфейса                     ║"
        echo "║  4. 📊 Настройки логов                          ║"
        echo "║  5. 💾 Настройки резервного копирования         ║"
        echo "║  6. 🔄 Обновление системы                       ║"
        echo "║  7. 🧹 Очистка системы                          ║"
        echo "║  8. 📋 Информация о системе                     ║"
        echo "║  9. ⚙️  Дополнительные настройки                ║"
        echo "║  0. ↩️  Назад                                    ║"
        echo "║                                                  ║"
        echo "╚══════════════════════════════════════════════════╝"
        echo -e "${NC}"
        
        read -p "Выберите действие: " choice
        
        case $choice in
            1) network_settings_menu ;;
            2) security_settings ;;
            3) ui_settings ;;
            4) log_settings ;;
            5) backup_settings ;;
            6) update_system ;;
            7) cleanup_system ;;
            8) system_info ;;
            9) advanced_settings ;;
            0) return ;;
            *) echo -e "${RED}[!] Неверный выбор${NC}"; sleep 1 ;;
        esac
    done
}

network_settings_menu() {
    clear
    echo -e "${CYAN}"
    echo "╔══════════════════════════════════════════════════╗"
    echo "║             НАСТРОЙКИ СЕТИ                       ║"
    echo "╚══════════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    current_hidden=$(grep "hidden_ip" "$APP_CONFIG" | cut -d= -f2)
    
    echo -e "${YELLOW}Текущие настройки:${NC}"
    echo "1. Скрытие IP: $current_hidden"
    echo "2. Текущий IP: $USER_IP"
    
    echo -e "\n${YELLOW}Доступные действия:${NC}"
    echo "1. Включить/выключить скрытие IP"
    echo "2. Сгенерировать новый IP"
    echo "3. Тестирование соединения"
    echo "4. Просмотр сетевой информации"
    
    read -p "Выбор: " choice
    
    case $choice in
        1)
            if [ "$current_hidden" = "true" ]; then
                sed -i 's/hidden_ip=true/hidden_ip=false/' "$APP_CONFIG"
                echo -e "${GREEN}[✓] Скрытие IP отключено${NC}"
            else
                sed -i 's/hidden_ip=false/hidden_ip=true/' "$APP_CONFIG"
                echo -e "${GREEN}[✓] Скрытие IP включено${NC}"
            fi
            ;;
        2)
            new_ip="$((RANDOM % 255)).$((RANDOM % 255)).$((RANDOM % 255)).$((RANDOM % 254 + 1))"
            echo -e "${GREEN}[✓] Новый IP: $new_ip${NC}"
            echo -e "${YELLOW}[i] Только для отображения, реальный IP не изменился${NC}"
            ;;
        3)
            echo -e "${YELLOW}[i] Тестирование соединения...${NC}"
            ping -c 3 8.8.8.8
            ;;
        4)
            echo -e "${YELLOW}[i] Сетевая информация:${NC}"
            if command -v ip &> /dev/null; then
                ip addr show
            else
                ifconfig
            fi
            ;;
    esac
    
    read -p "Нажмите Enter..."
}

# ==================== АККАУНТ ПОЛЬЗОВАТЕЛЯ ====================
account_menu() {
    while true; do
        clear
        echo -e "${CYAN}"
        echo "╔══════════════════════════════════════════════════╗"
        echo "║              НАСТРОЙКИ АККАУНТА                 ║"
        echo "╠══════════════════════════════════════════════════╣"
        echo "║  Пользователь: $CURRENT_USER"
        echo "║  ID: $USER_ID"
        echo "║  Роль: $USER_ROLE"
        echo "╠══════════════════════════════════════════════════╣"
        echo "║                                                  ║"
        echo "║  1. 👤 Изменить имя пользователя                ║"
        echo "║  2. 🔑 Изменить пароль                          ║"
        echo "║  3. 🏷️  Изменить описание                       ║"
        echo "║  4. 📧 Настройки уведомлений                    ║"
        echo "║  5. 📱 Двухфакторная аутентификация             ║"
        echo "║  6. 📊 Статистика аккаунта                      ║"
        echo "║  7. 🗑️  Удалить аккаунт                         ║"
        echo "║  8. 📋 История активности                       ║"
        echo "║  9. 🛡️  Безопасность аккаунта                   ║"
        echo "║  0. ↩️  Назад                                    ║"
        echo "║                                                  ║"
        echo "╚══════════════════════════════════════════════════╝"
        echo -e "${NC}"
        
        read -p "Выберите действие: " choice
        
        case $choice in
            1) change_username ;;
            2) change_password ;;
            3) change_description ;;
            4) notification_settings ;;
            5) two_factor_auth ;;
            6) account_statistics ;;
            7) delete_account ;;
            8) activity_history ;;
            9) account_security ;;
            0) return ;;
            *) echo -e "${RED}[!] Неверный выбор${NC}"; sleep 1 ;;
        esac
    done
}

change_password() {
    clear
    echo -e "${CYAN}"
    echo "╔══════════════════════════════════════════════════╗"
    echo "║             ИЗМЕНЕНИЕ ПАРОЛЯ                    ║"
    echo "╚══════════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    read -sp "Текущий пароль: " current_pass
    echo
    
    # Проверка текущего пароля
    user_line=$(grep "^$CURRENT_USER|" "$USERS_DB")
    stored_hash=$(echo "$user_line" | cut -d'|' -f2)
    input_hash=$(echo -n "${current_pass}${USER_ID}" | sha256sum | cut -d' ' -f1)
    
    if [ "$input_hash" != "$stored_hash" ]; then
        echo -e "${RED}[!] Неверный текущий пароль${NC}"
        read -p "Нажмите Enter..."
        return
    fi
    
    # Новый пароль
    while true; do
        read -sp "Новый пароль: " new_pass1
        echo
        read -sp "Подтвердите новый пароль: " new_pass2
        echo
        
        if [ "$new_pass1" != "$new_pass2" ]; then
            echo -e "${RED}[!] Пароли не совпадают${NC}"
            continue
        fi
        
        if [ ${#new_pass1} -lt 8 ]; then
            echo -e "${RED}[!] Пароль должен быть не менее 8 символов${NC}"
            continue
        fi
        
        # Проверка сложности
        if ! [[ "$new_pass1" =~ [A-Z] ]] || ! [[ "$new_pass1" =~ [0-9] ]]; then
            echo -e "${YELLOW}[!] Рекомендуется использовать заглавные буквы и цифры${NC}"
            read -p "Продолжить? (y/n): " weak_pass
            if [ "$weak_pass" != "y" ]; then
                continue
            fi
        fi
        
        break
    done
    
    # Обновление пароля
    new_hash=$(echo -n "${new_pass1}${USER_ID}" | sha256sum | cut -d' ' -f1)
    sed -i "s/^$CURRENT_USER|.*$/$CURRENT_USER|$new_hash|$USER_ID|$USER_ROLE|$(date +%s)|$USER_IP|active/" "$USERS_DB"
    
    echo -e "\n${GREEN}[✓] Пароль успешно изменен${NC}"
    log_system "PASSWORD_CHANGE" "Пользователь $CURRENT_USER изменил пароль" "INFO"
    
    read -p "Нажмите Enter..."
}

# ==================== СТАТИСТИКА ====================
statistics_menu() {
    clear
    echo -e "${CYAN}"
    echo "╔══════════════════════════════════════════════════╗"
    echo "║                 СТАТИСТИКА                       ║"
    echo "╚══════════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    echo -e "${YELLOW}[i] Сбор статистики...${NC}"
    
    # Статистика пользователей
    user_count=$(wc -l < "$USERS_DB")
    active_users=$(grep -c "|active$" "$USERS_DB")
    
    # Статистика каналов
    channel_count=$(wc -l < "$CHANNELS_DB")
    active_channels=$(grep -c "|active$" "$CHANNELS_DB")
    
    # Статистика сетей
    network_count=$(wc -l < "$NETWORKS_DB")
    
    # Статистика шифрования
    encryption_count=$(wc -l < "$ENCRYPTION_DB")
    
    # Статистика файлов
    if [ -f "$FILES_DB" ]; then
        file_count=$(wc -l < "$FILES_DB")
    else
        file_count=0
    fi
    
    # Статистика логов
    log_lines=$(wc -l < "$LOG_FILE")
    
    # Время работы системы
    if [ -f "$BASE_DIR/start_time" ]; then
        start_time=$(cat "$BASE_DIR/start_time")
        current_time=$(date +%s)
        uptime_seconds=$((current_time - start_time))
        uptime_days=$((uptime_seconds / 86400))
        uptime_hours=$(( (uptime_seconds % 86400) / 3600 ))
        uptime_minutes=$(( (uptime_seconds % 3600) / 60 ))
    else
        uptime_days=0
        uptime_hours=0
        uptime_minutes=0
    fi
    
    echo -e "\n${BLUE}ОБЩАЯ СТАТИСТИКА:${NC}"
    echo -e "${GREEN}┌────────────────────────────────────────────┐${NC}"
    echo -e "${GREEN}│  Пользователи: $user_count (активных: $active_users) │${NC}"
    echo -e "${GREEN}│  Каналы: $channel_count (активных: $active_channels) │${NC}"
    echo -e "${GREEN}│  Сети: $network_count                     │${NC}"
    echo -e "${GREEN}│  Операции шифрования: $encryption_count       │${NC}"
    echo -e "${GREEN}│  Файловые операции: $file_count           │${NC}"
    echo -e "${GREEN}│  Записей в логе: $log_lines              │${NC}"
    echo -e "${GREEN}│  Время работы: ${uptime_days}д ${uptime_hours}ч ${uptime_minutes}м │${NC}"
    echo -e "${GREEN}└────────────────────────────────────────────┘${NC}"
    
    # Статистика текущего пользователя
    echo -e "\n${BLUE}ВАША СТАТИСТИКА:${NC}"
    user_encryption_count=$(grep -c "|$CURRENT_USER|" "$ENCRYPTION_DB")
    user_channels=$(grep -c "|$CURRENT_USER|" "$CHANNELS_DB")
    user_networks=$(grep -c "|$CURRENT_USER|" "$NETWORKS_DB")
    
    echo -e "Операций шифрования: $user_encryption_count"
    echo -e "Создано каналов: $user_channels"
    echo -e "Создано сетей: $user_networks"
    
    read -p "Нажмите Enter..."
}

# ==================== ПОМОЩЬ И ПОДДЕРЖКА ====================
help_menu() {
    clear
    echo -e "${CYAN}"
    echo "╔══════════════════════════════════════════════════╗"
    echo "║           ПОМОЩЬ И ПОДДЕРЖКА                    ║"
    echo "╠══════════════════════════════════════════════════╣"
    echo "║                                                  ║"
    echo "║  1. 📖 Руководство пользователя                 ║"
    echo "║  2. ❓ Часто задаваемые вопросы                  ║"
    echo "║  3. 🛠️  Устранение неполадок                    ║"
    echo "║  4. 📞 Связаться с поддержкой                   ║"
    echo "║  5. 💡 Советы по безопасности                   ║"
    echo "║  6. 📚 Команды и горячие клавиши                ║"
    echo "║  7. 🔄 Обновление и установка                   ║"
    echo "║  8. ⚖️  Лицензия и условия                      ║"
    echo "║  9. 👨‍💻 О разработчике                          ║"
    echo "║  0. ↩️  Назад                                    ║"
    echo "║                                                  ║"
    echo "╚══════════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    read -p "Выберите раздел: " choice
    
    case $choice in
        1) user_guide ;;
        2) faq ;;
        3) troubleshooting ;;
        4) contact_support ;;
        5) security_tips ;;
        6) commands_help ;;
        7) update_help ;;
        8) license_info ;;
        9) about_developer ;;
        0) return ;;
        *) echo -e "${RED}[!] Неверный выбор${NC}"; sleep 1 ;;
    esac
}

about_developer() {
    clear
    echo -e "${CYAN}"
    echo "╔══════════════════════════════════════════════════╗"
    echo "║               О РАЗРАБОТЧИКЕ                     ║"
    echo "╚══════════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    echo -e "${GREEN}TERMINAL : ENCRYPTOR v1.1${NC}"
    echo -e "${YELLOW}Автор: terminaldestrroyrr${NC}"
    echo -e "${BLUE}Telegram: @bred37${NC}"
    echo -e "${PURPLE}Лицензия: MIT License${NC}"
    
    echo -e "\n${YELLOW}О программе:${NC}"
    echo "Terminal : Encryptor - это мощный инструмент для шифрования"
    echo "и защиты данных в терминале. Программа предоставляет"
    echo "полный набор инструментов для обеспечения безопасности."
    
    echo -e "\n${YELLOW}Возможности:${NC}"
    echo "✓ Шифрование текста и файлов"
    echo "✓ Управление защищенными каналами"
    echo "✓ Создание приватных сетей"
    echo "✓ Аудит безопасности"
    echo "✓ Полный контроль над данными"
    
    echo -e "\n${YELLOW}Контакты:${NC}"
    echo "Telegram: @bred37"
    echo "Поддержка: через Telegram"
    echo "Исходный код: доступен по запросу"
    
    echo -e "\n${YELLOW}Благодарности:${NC}"
    echo "Спасибо всем, кто поддерживает развитие проекта!"
    
    read -p "Нажмите Enter..."
}

# ==================== ВЫХОД ====================
logout_user() {
    echo -e "${YELLOW}[i] Завершение сессии...${NC}"
    log_system "USER_LOGOUT" "Выход пользователя: $CURRENT_USER" "INFO"
    
    # Очистка сессионного файла
    rm -f "$SESSION_FILE"
    
    CURRENT_USER=""
    USER_ID=""
    USER_ROLE=""
    
    echo -e "${GREEN}[✓] Вы вышли из системы${NC}"
    sleep 1
    show_login_menu
}

exit_app() {
    clear
    echo -e "${CYAN}"
    echo "╔══════════════════════════════════════════════════╗"
    echo "║          TERMINAL : ENCRYPTOR v1.1              ║"
    echo "║                                                  ║"
    echo "║         Спасибо за использование!               ║"
    echo "║                                                  ║"
    echo "║         Автор: terminaldestrroyrr               ║"
    echo "║         Telegram: @bred37                       ║"
    echo "║                                                  ║"
    echo "╚══════════════════════════════════════════════════╝"
    echo -e "${NC}"
    
    log_system "APP_EXIT" "Завершение работы приложения" "INFO"
    
    # Очистка временных файлов
    rm -rf "$TEMP_DIR"/*
    
    exit 0
}

# ==================== ЗАПУСК ПРОГРАММЫ ====================
# Сохранение времени запуска
echo "$(date +%s)" > "$BASE_DIR/start_time"

# Инициализация системы
init_system

# Запуск главного меню
show_login_menu
